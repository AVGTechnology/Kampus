{% extends "baseform.html" %}
{% block content %}
{% load static %}
  <div class="navbar-fixed">
     <nav>
    <div class="nav-wrapper " style="background-color: #2e0018;">
      <a href="#!" class="left" style= "margin-left: 10px; font-size: 25px;">Kampus</a>
      <ul class="right ">
        <li><a href="{% url 'discover_post' %}"><i class="material-icons">search</i></a></li>
        <li><a href="{% url 'index' %}"><i class="material-icons">refresh</i></a></li>
        <li><a href="{% url 'kampus_app' %}"><i class="material-icons">more_vert</i></a></li>
      </ul>
    </div>
  </nav>
  </div>
<div class="content" style="background-color: #ffffff;">

        <br>
        <div class="row valign-wrapper space">
            <div class="col s15">
                <img src={{posts.user.owner.image.url}}
                     width="50px" height="50px"
                     alt="" class="circle">
            </div>
            <div class="col s16">
                <b>{{ posts.user}}</b>
                <p><font color="#9e9e9e">{{ posts.user.owner.profession}}</font></p>
            </div>
        </div>
        <div class="space">
            <div class="">
                <b>{{ posts.caption}}</b>
            </div>
            {% if posts.file.url|slice:"-4:" == ".mp4" %}
                   <video class="responsive-video" controls="controls" poster="{{ MEDIA_URL }}/media/media/Post_thumbnail/{{posts.pk}}.jpg">

                        <source src="{{posts.file.url}}" type="video/mp4" style="max-width: 100%;">

                    </video>
            {% else %}
            <img class="responsive-img" src={{posts.file.url}}>
            {% endif %}
        </div>
        <br>
                       <div class="row valign-wrapper">
                    <div class="col s15">

                        {% if user in posts.like.all%}

                            <i id="unlike{{posts.pk}}" class="material-icons" onclick="myFunction({{posts.pk}});"
                               style="font-size: 30px;  color: red;">favorite</i>

                        {% else %}

                            <i  id="{{posts.pk}}" class="material-icons" onclick="myFunction({{posts.pk}});"
                               style="font-size: 30px; text-decoration: none; color: #292929">favorite</i>

                        {% endif %}

        <script>
        function myFunction(posts_pk) {
       console.log(posts_pk);
       $.ajax({type: "GET",
        url: "{% url 'like' %}",
        data: {
            "pk": posts_pk
        },
        dataType: "json",
        success: function (data) {
            // any process in data
            console.log(data);
            if (data.liked) {
            console.log("likeeeeeeeeeeee");
            M.toast({html: 'post liked !'})
                //$('#product-'+product).fadeOut;
            var el_like = document.getElementById(posts_pk)
            el_like.style.color = "red";
            }
           if (data.unliked) {
              console.log("unlikeeeeeeeeeeee");
              M.toast({html: 'post unliked !'})
              var el_like = document.getElementById(posts_pk)
              el_like.style.color = "#292929";

            }

        },
        failure: function () {
            console.log("failure");
        }
 });
 }
 </script>
</div>

            <div class="col s15">
                <a href="{% url 'comment_view' posts.pk %}">
                    <i class="material-icons" style="font-size: 30px; text-decoration: none; color: #292929">comment</i>
                </a>
            </div>

            <div class="col s15">
                <i class="material-icons" style="font-size: 30px; text-decoration: none; color: #292929">send</i>
            </div>

            <div class="col s1">
                <a href="{{posts.file.url}}" class="pull-right" download>
                <i class="material-icons right" style="font-size: 30px; text-decoration: none; color: #292929">file_download</i>
                    </a>
            </div>

        </div>

          <div class="row valign-wrapper">
            <div class="col s15">
                <a href="{% url 'likes' posts.pk %}">
                <b style="color: black;">{{posts.like.count}} likes</b>
                </a>
            </div>

            <div class="col s15">
                <b>{{comments.count}} comments</b>
            </div>

        </div>
        <div style="">
            <form action="{% url 'comment' posts.pk %}" method="post">
                {% csrf_token %}
                <input class="form-control me-2" type="search" placeholder="write a comments..." name="comment"
                       value="{{ comment }}"
                       aria-label="Search" id="comment">
                <br>
                <button type="submit" class="btn btn-medium cyan  right" style="margin-right:20px;">comment</button>
            </form>
        </div>
        <br>
        <br>
        <div>

            {% if comments %}
            {% for comments in comments %}

            <div class="row valign-wrapper space">
                <div class="col s15">
                    <img src={{comments.user.owner.image.url}}

                         width="30px" height="30px"
                         alt="" class="circle">
                </div>
                <div class="col s16">
                    <b>{{ comments.user}}</b>
                    <font size='4px;' color="#000;">{{ comments.comment}}</font><br>
                    <font>{{ comments.timestamp|date:"D d M Y" }}</font>
                </div>
            </div>
            <br>
            {% endfor %}
            {% else %}
            <h5>No comments...</h5>
            {% endif %}
            <br>

        </div>

    </div>
</div>

{% endblock %}